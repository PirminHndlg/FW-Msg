{% extends 'baseEhemalige.html' %}
{% load i18n %}
{% load static %}

{% block title %}
  {% trans "Dashboard" %}
{% endblock %}

{% block head %}
  <style>
    .dashboard-section {
      margin-bottom: 2rem;
    }
    
    .section-header {
      border-bottom: 2px solid #f8f9fa;
      padding-bottom: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #495057;
      margin: 0;
    }
    
    .card-compact {
      border: 1px solid #e9ecef;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    
    .grid-2 { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 1.5rem; 
    }
    
    .grid-3 { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 1.5rem; 
    }
    
    @media (max-width: 768px) {
      .grid-2, .grid-3 { 
        grid-template-columns: 1fr; 
      }
    }

    .welcome-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }
  </style>
{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="mb-4">
  <div class="d-flex align-items-center justify-content-between">
    <h1 class="h2 mb-1">{% trans "Dashboard" %}</h1>
    {% if user.ehemalige.land.exists %}
    <div class="d-flex align-items-center">
      {% for land in user.ehemalige.land.all %}
        <span class="fi fi-{{ land.code|lower }} me-2 border" style="font-size: 2rem;"></span>
      {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

<!-- Welcome Section
<div class="dashboard-section">
  <div class="card welcome-card">
    <div class="card-body text-center py-5">
      <i class="bi bi-people-fill mb-3" style="font-size: 3rem;"></i>
      <h3 class="mb-3">{% trans "Willkommen auf Volunteer.Solutions!" %}</h3>
      <p class="mb-4" style="font-size: 1.1rem;">
        {% trans "Hast du Fragen, Anregungen oder möchtest einfach Hallo sagen? Wir freuen uns von dir zu hören!" %}
      </p>
      <div class="d-flex justify-content-center gap-3 flex-wrap">
        <a href="{% url 'feedback' %}" class="btn btn-light btn-lg">
          <i class="bi bi-chat-dots me-2"></i>{% trans "Feedback senden" %}
        </a>
      </div>
    </div>
  </div>
</div>
 -->

{% include 'components/seminar_display_info.html' %}

<!-- Content Section -->
{% if posts or gallery_images %}
<div class="dashboard-section">
  {% comment %} <div class="section-header">
    <h2 class="section-title">
      <i class="bi bi-activity me-2 text-primary"></i>
      {% trans "Neueste Inhalte" %}
    </h2>
  </div> {% endcomment %}
  
  <div class="row g-3">
    <!-- Recent Posts -->
    {% if user.customuser.person_cluster.posts %}
    <div class="col-12 {% if user.customuser.person_cluster.bilder %}col-lg-4 col-xl-6{% endif %}">
      <div class="card card-compact h-100">
      <div class="card-header bg-white border-bottom-0">
        <div class="d-flex justify-content-between align-items-center">
          <a href="{% url 'posts_overview' %}" class="text-decoration-none text-body">
            <h5 class="mb-0">
                <i class="bi bi-newspaper me-2"></i>
                {% trans "Neueste Posts" %}
            </h5>
          </a>
        </div>
      </div>
      <div class="card-body">
        {% if posts %}
            {% for post in posts|slice:":4" %}
            <a href="{% url 'post_detail' post.id %}" class="text-decoration-none text-body">
              <div class="px-0 border-0 py-2">
                <h6 class="mb-1">{{ post.title }}</h6>
                <p class="mb-1 text-muted small">{{ post.text|truncatewords:15 }}</p>
                <small class="text-muted">
                  <i class="bi bi-person me-1"></i>{{ post.user.get_full_name|default:post.user.username }}
                  <i class="bi bi-calendar ms-2 me-1"></i>{{ post.date|date:'d.m.Y' }}
                </small>
              </div>
            </a>
            {% if not forloop.last %}
            <hr class="my-2">
            {% endif %}
            {% endfor %}
          <div class="text-center mt-3">
            <a href="{% url 'posts_overview' %}" class="btn btn-sm btn-outline-primary">
              {% trans "Alle Posts" %}
            </a>
          </div>
        {% else %}
          <div class="text-center py-4">
            <i class="bi bi-newspaper text-muted mb-2" style="font-size: 2rem"></i>
            <p class="text-muted mb-0">{% trans "Keine Posts vorhanden" %}</p>
          </div>
        {% endif %}
      </div>
      </div>
    </div>
    {% endif %}

    <!-- Recent Images -->
    {% if user.customuser.person_cluster.bilder %}
    <div class="col-12 {% if user.customuser.person_cluster.posts %}col-lg-8 col-xl-6{% endif %}">
      <div class="card card-compact h-100">
      <div class="card-header bg-white border-bottom-0">
        <div class="d-flex justify-content-between align-items-center">
          <a href="{% url 'bilder' %}" class="text-decoration-none text-body">
          <h5 class="mb-0">
            <i class="bi bi-images me-2"></i>
            {% trans "Neueste Bilder" %}
            </h5>
          </a>
        </div>
      </div>
      <div class="card-body">
        {% if gallery_images %}
          <!-- Image Carousel -->
          <div class="row g-3">
              {% include 'bilder_show.html' with gallery_images=gallery_images small=True %}
          </div>

          <div class="text-center mt-3">
            <a href="{% url 'bilder' %}" class="btn btn-sm btn-outline-primary">
              {% trans "Alle Bilder" %}
            </a>
          </div>
        {% else %}
          <div class="text-center py-4">
            <i class="bi bi-images text-muted mb-2" style="font-size: 2rem"></i>
            <p class="text-muted mb-0">{% trans "Keine Bilder vorhanden" %}</p>
          </div>
        {% endif %}
      </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endif %}

<!-- Tasks Section -->
{% if my_tasks %}
<div class="dashboard-section">
  {% comment %} <div class="section-header">
    <h2 class="section-title">
      <i class="bi bi-list-task me-2 text-primary"></i>
      {% trans "Meine Aufgaben" %}
    </h2>
  </div> {% endcomment %}
  
  <div class="card card-compact">
    <div class="card-header bg-white border-bottom-0">
      <div class="d-flex justify-content-between align-items-center">
        <a href="{% url 'aufgaben' %}" class="text-decoration-none text-body">
        <h5 class="mb-0">
          <i class="bi bi-person-check me-2"></i>
            {% trans "Meine Aufgaben" %}
          </h5>
        </a>
        <span class="badge bg-primary rounded-pill">{{ my_tasks.count }}</span>
      </div>
    </div>
    <div class="card-body">
      {% if my_tasks %}
        <div class="list-group list-group-flush">
          <div class="row row-cols-1 row-cols-xxl-2 g-3">
              {% for task in my_tasks|slice:":4" %}
                  {% include 'components/task_card.html' with task=task %}
              {% endfor %}
          </div>
        </div>
        {% if my_tasks.count > 4 %}
          <div class="text-center mt-3">
            <a href="{% url 'aufgaben' %}" class="btn btn-sm btn-outline-primary">
              {% trans "Alle" %} {{ my_tasks.count }} {% trans "anzeigen" %}
            </a>
          </div>
        {% endif %}
      {% else %}
        <div class="text-center py-4">
          <i class="bi bi-check2-circle text-success mb-2" style="font-size: 2rem"></i>
          <p class="text-muted mb-0">{% trans "Keine offenen Aufgaben" %}</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
