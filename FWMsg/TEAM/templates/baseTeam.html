{% load static %}
{% load base_filter %}
{% load i18n %}
{% load team_filter %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    {% include 'header.html' %}

    <title>
      {% block title %}

      {% endblock %}
    </title>

    {% block head %}

    {% endblock %}

    {% block scripts %}

    {% endblock %}
  </head>
  <body>
    <div class="d-flex">
      {# Sidebar Navigation #}
      <div class="content w-100">
        <nav class="navbar bg-primary navbar-expand-md">
          <div class="container-fluid">
            {# Organization Logo and Name #}
            <a class="navbar-brand" href="{% url 'index_home' %}">
              {% with org=user|get_org %}
                <img src="{% url 'serve_image' org.id %}"
                  alt="{% if org.kurzname %}
                    {{ org.kurzname }}
                  {% else %}
                    {{ org.name }}
                  {% endif %}-Logo"
                  height="30"
                  class="d-inline-block align-text-top" />
              {% endwith %}
            </a>

            <!-- Hamburger Button for Mobile -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

            <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                  <a class="nav-link text-white" href="{% url 'team_home' %}"><i class="bi bi-house"></i> {% trans 'Home' %}</a>
                </li>
                {% if user.customuser.person_cluster.aufgaben %}
                  <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'aufgaben' %}"><i class="bi bi-list-check"></i> {% trans 'Aufgaben' %}</a>
                  </li>
                {% endif %}
                {% if user.customuser.person_cluster.calendar %}
                  <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'kalender' %}"><i class="bi bi-calendar-date"></i> {% trans 'Kalender' %}</a>
                  </li>
                {% endif %}
                {% if user.customuser.person_cluster.dokumente %}
                  <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'dokumente' %}"><i class="bi bi-file-earmark-text"></i> {% trans 'Dokumente' %}</a>
                  </li>
                {% endif %}
                {% if user.customuser.person_cluster.map %}
                  <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'karte' %}"><i class="bi bi-map"></i> {% trans 'Karte' %}</a>
                  </li>
                {% endif %}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle text-white" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Ländermanagement</a>
                  <div class="dropdown-menu dropdown-menu-start" aria-labelledby="navbarDropdown">
                    <a href="{% url 'laender_info' %}" class="dropdown-item">Einsatzländer</a>
                    <a href="{% url 'einsatzstellen_info' %}" class="dropdown-item">Einsatzstellen</a>
                    <a href="{% url 'einsatzstellen_notiz' %}" class="dropdown-item">Protokolle</a>
                  </div>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle text-white" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Freiwillige</a>
                  <div class="dropdown-menu dropdown-menu-start" aria-labelledby="navbarDropdown">
                    <a href="{% url 'team_contacts' %}" class="dropdown-item">Kontakte</a>
                    <a href="{% url 'list_ampel' %}" class="dropdown-item">Ampelmeldung</a>
                    <a href="{% url 'bilder' %}" class="dropdown-item">Bilder</a>
                  </div>
                </li>
              </ul>

              <div class="d-flex gap-2">
                <div class="d-flex">
                  <a href="{% url 'settings' %}" class="btn btn-light"><i class="bi bi-gear me-1"></i></a>
                </div>

                <!-- Profile Button -->
                <div class="d-flex">
                  <a href="{% url 'profil' %}" class="btn btn-light"><i class="bi bi-person me-1"></i></a>
                </div>
              </div>
            </div>
          </div>
        </nav>

        {# Main Content Area #}
        <div class="container-fluid mt-3 mb-5">
          {% include 'error_message.html' %}
          {% block content %}

          {% endblock %}
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Handle personen_cluster selection
        document.querySelectorAll('[data-person-cluster]').forEach((item) => {
          item.addEventListener('click', function (e) {
            e.preventDefault()
            const personClusterId = this.dataset.personCluster
            const personClusterName = this.textContent.trim()
      
            // Save to cookies
            if (personClusterId) {
              Cookies.set('selectedPersonCluster', personClusterId, { expires: 365 })
              Cookies.set('selectedPersonClusterName', personClusterName, { expires: 365 })
            } else {
              Cookies.remove('selectedPersonCluster')
              Cookies.remove('selectedPersonClusterName')
            }
      
            // Update dropdown text
            document.getElementById('selectedPersonCluster').textContent = personClusterName
      
            // Reload current page
            window.location.reload()
          })
        })
      
        // Set initial dropdown text from cookie
        const savedPersonClusterName = Cookies.get('selectedPersonClusterName')
        if (savedPersonClusterName) {
          document.getElementById('selectedPersonCluster').textContent = savedPersonClusterName
        }
      })
    </script>
  </body>
</html>
