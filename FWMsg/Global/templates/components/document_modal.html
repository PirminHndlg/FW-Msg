{% load i18n %}

<div class="modal fade" id="dokumentModal" tabindex="-1" aria-labelledby="dokumentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <div>
          <h5 class="modal-title mb-1" id="dokumentModalLabel">{% trans 'Neues Dokument hinzufügen' %}</h5>
          <small class="text-muted"><i class="bi bi-folder me-1"></i><span id="modalFolderName"></span></small>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="dokumentForm" method="post" enctype="multipart/form-data" action="{% url 'add_dokument' %}">
          {% csrf_token %}
          <input type="hidden" name="ordner" id="ordnerInput" />
          <input type="hidden" name="dokument_id" id="dokumentIdInput" />

          <div class="mb-2 text-center d-flex justify-content-center align-items-center gap-1">
            <i class="bi bi-info-circle me-1"></i>
            <small class="text-muted">{% trans 'Alle Felder sind optional und können weggelassen werden.' %}</small>
          </div>

          <div class="mb-3">
            <label for="titel" class="form-label">{% trans 'Titel' %}</label>
            <input type="text" class="form-control rounded-4" id="titel" name="titel" placeholder="..." />
          </div>

          <div class="mb-3">
            <label for="beschreibung" class="form-label">{% trans 'Beschreibung' %}</label>
            <textarea class="form-control rounded-4" id="beschreibung" name="beschreibung" rows="3" placeholder="..."></textarea>
          </div>

          <div class="mb-3">
            <label for="link" class="form-label">{% trans 'Link' %}</label>
            <input type="text" class="form-control rounded-4" id="link" name="link" placeholder="https://www.example.com" />
            <div class="form-text">{% trans 'Link zu einer externen Seite' %}</div>
          </div>

          <div id="existingDocumentWarning" class="text-danger d-none">
            {% trans 'Neues Dokument' %} <span id="existingDocumentName"></span> {% trans 'wird gelöscht, wenn ein neues Dokument hochgeladen wird.' %}
          </div>

          <div class="mb-3">
            <label for="dokument" class="form-label">{% trans 'Dokument' %}</label>
            <div class="upload-container position-relative">
                <input type="file" class="form-control" name="dokument" id="dokument" 
                       style="z-index: 2;">
                <div class="upload-overlay d-flex flex-column align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100"
                     style="z-index: 1; pointer-events: none;">
                    <i class="bi bi-cloud-upload display-4 text-primary"></i>
                </div>
            </div>
            <div class="form-text">{% trans 'Datei hochladen' %}</div>
          </div>

          <div id="darf_bearbeiten_container" class="mb-3">
            <label class="form-label">{% trans 'Bearbeiten dürfen' %}</label>
            <div class="border rounded-3 p-3">
              {% for person_cluster in person_clusters %}
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="darf_bearbeiten" value="{{ person_cluster.id }}" id="person_cluster_{{ person_cluster.id }}">
                  <label class="form-check-label" for="person_cluster_{{ person_cluster.id }}">
                    {{ person_cluster.name }}
                  </label>
                </div>
              {% endfor %}
            </div>
            <div class="form-text">{% trans 'Person Cluster, die dieses Dokument bearbeiten/löschen dürfen' %}</div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary rounded-4" data-bs-dismiss="modal">{% trans 'Abbrechen' %}</button>
            <button type="submit" class="btn btn-primary rounded-4">{% trans 'Speichern' %}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% include 'components/fullscreen_drop_zone.html' %}

<script>
    document.addEventListener('DOMContentLoaded', function (event) {
        initFullscreenDropZone('dokument', {
        });
    });
</script>