{% load i18n %}

<div class="card rounded-4 mb-2">
    <div class="card-header p-0 rounded-4">
        <button class="accordion-button collapsed rounded-4 ps-2" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#collapse{{ structure.ordner.id }}" 
                aria-expanded="false" 
                aria-controls="collapse{{ structure.ordner.id }}">
            <div class="d-flex justify-content-between align-items-center w-100 me-3">
                <span>
                    {% if structure.ordner.color %}
                        <div class="vr rounded-1 me-1 opacity-100" style="background-color: {{ structure.ordner.color.color }}; width: 10px;"></div>
                    {% endif %}
                    <i id="folderIcon{{ structure.ordner.id }}" class="bi bi-folder me-2"></i>
                    <span id="folderSpinner{{ structure.ordner.id }}" class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                    {{ structure.ordner }}
                </span>
                <span class="badge bg-secondary">{{ structure.dokumente|length }}</span>
            </div>
        </button>
    </div>
    <div id="collapse{{ structure.ordner.id }}" 
            class="accordion-collapse collapse" 
            aria-labelledby="heading{{ structure.ordner.id }}" 
            data-bs-parent="#folderAccordion">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex gap-2">
                    {% if user.role == 'O' %}

                    <button class="btn btn-outline-danger btn-sm rounded-4" 
                            onclick="removeOrdner({{ structure.ordner.id }}, '{{ structure.ordner }}')"
                            {% if structure.dokumente|length > 0 %}
                            data-bs-toggle="tooltip"
                            data-bs-title="{% trans 'Der muss vor dem Löschen leer sein' %}"
                            {% endif %}>
                        <i class="bi bi-trash"></i>
                    </button>

                    <button class="btn btn-sm btn-outline-secondary rounded-4" 
                            data-bs-toggle="tooltip"
                            data-bs-title="{% trans 'Ordner bearbeiten' %}"
                            onclick="editOrdner({{ structure.ordner.id }}, '{{ structure.ordner }}', '{% for typ in structure.ordner.typ.all %}{{ typ.id }},{% endfor %}', '{% if structure.ordner.color %}{{ structure.ordner.color.id }}{% endif %}')">
                        <i class="bi bi-pencil"></i>
                    </button>

                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary rounded-4 dropdown-toggle" 
                                type="button" 
                                id="copyLinkDropdown{{ structure.ordner.id }}" 
                                data-bs-toggle="dropdown" 
                                aria-expanded="false"
                                data-bs-title="{% trans 'Link zum Ordner kopieren' %}">
                            <i class="bi bi-clipboard"></i>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="copyLinkDropdown{{ structure.ordner.id }}">
                            <li>
                                <a class="dropdown-item" 
                                   href="#" 
                                   onclick="event.preventDefault(); copyFolderLink('{% url 'dokumente' structure.ordner.id %}', this);">
                                    <i class="bi bi-link-45deg me-2"></i>{% trans 'Link zum Ordner kopieren' %}
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item"
                                   href="#"
                                   onclick="event.preventDefault(); copyPublicFolderLink('{% url 'get_public_link_ordner' structure.ordner.id %}', this);">
                                    <div class="d-flex align-items-start">
                                        <i class="bi bi-globe me-2 mt-1"></i>
                                        <div>
                                            <div>{% trans 'Öffentlichen Link kopieren' %}</div>
                                            <small class="text-muted">{% trans '14 Tage gültig' %}</small>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>


                    <div class="d-flex gap-2 align-items-center flex-wrap" data-bs-toggle="tooltip" data-bs-title="Ordner ist sichtbar für:">
                        {% for typ in structure.ordner.typ.all %}
                            <span class="badge bg-secondary me-1 word-break">{{ typ.name }}</span>
                        {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <button class="btn btn-primary btn-sm rounded-4" 
                        onclick="addDokument({{ structure.ordner.id }})">
                    <i class="bi bi-plus-lg"></i> {% trans "Neues Dokument" %}
                </button>
            </div>
            <div class="row g-3">
                {% for dokument in structure.dokumente %}
                    {% include "components/document_card.html" %}
                {% endfor %}
            </div>
        </div>
    </div>
</div> 