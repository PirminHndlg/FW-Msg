{% extends extends_base|default:'baseFw.html' %}
{% load static %}
{% load base_fw_filter %}
{% load dokument_filter %}
{% load i18n %}

{% block head %}
  <script src="{% static 'js/dokumente.js' %}"></script>
  <script>
    let is_org = {% if user.customuser.person_cluster.view == 'O' %}true{% else %}false{% endif %}
    let ordner_id = '{{ ordner_id }}'
    
    document.addEventListener('DOMContentLoaded', function () {
      const accordionCollapses = document.querySelectorAll('.accordion-collapse')
    
      function handleCollapseShow(collapse) {
        collapse.querySelectorAll('[data-preview-src]').forEach((img) => {
          if (!img.src) {
            img.src = img.dataset.previewSrc
          }
        })
      }
    
      accordionCollapses.forEach((collapse) => {
        collapse.addEventListener('show.bs.collapse', function () {
          handleCollapseShow(this)
        })
      })
    
      if (ordner_id) {
        const element = document.getElementById('folderAccordion').querySelector(`[data-bs-target="#collapse${ordner_id}"]`)
        if (element) {
          element.click()
          setTimeout(() => {
            const cardBody = element.closest('.card').querySelector('.card-body')
            cardBody.scrollIntoView({ behavior: 'smooth', block: 'start' })
          }, 350)
        }
      }
    })
  </script>
{% endblock %}

{% block headline %}
  {% trans 'Dokumente' %}
{% endblock %}

{% block content %}
  {% csrf_token %}
  {% if error %}
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle-fill"></i>
      {{ error }}
    </div>
  {% else %}
    <div class="card rounded-4 mb-4">
      <div class="card-header rounded-4">
        <div class="d-flex justify-content-between align-items-center">
          <h3 class="mb-0">{% trans 'Dokumente' %}</h3>

          {% if user.customuser.person_cluster.view == 'O' %}
            <button class="btn btn-sm btn-primary rounded-4" onclick="addOrdner()"><i class="bi bi-folder-plus me-2"></i> {% trans 'Neuer Ordner' %}</button>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="accordion mb-3" id="folderAccordion">
      {% for structure in folder_structure %}
        {% include 'components/folder_card.html' %}
      {% endfor %}
    </div>
  {% endif %}

  {% include 'components/document_modal.html' %}
  {% include 'components/folder_modal.html' %}
{% endblock %}
