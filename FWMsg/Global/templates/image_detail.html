{% extends extends_base|default:'baseFw.html' %}
{% load static %}
{% load i18n %}

{% block title %}
  {{ bild.titel }} -{% trans 'Bild Details' %}
{% endblock %}

{% block head %}
  <style>
    /* Instagram-style layout optimizations */
    .main-image {
      max-height: 70vh;
      object-fit: contain;
    }
    
    /* Mobile optimizations */
    @media (max-width: 991.98px) {
      .main-image {
        max-height: 60vh;
      }
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Back Button -->
  <button class="btn btn-outline-secondary rounded-3 mb-3" style="z-index: 1000;" onclick="history.back()"><i class="bi bi-arrow-left"></i>{% trans 'Zur√ºck' %}</button>
  
      <div class="card shadow-sm">
          <div class="card-body">
        <div class="row">
          <div class="col-lg-8 order-2 order-lg-1">
            <div class="text-center">
                {% for bild_gallery in bilder_gallery %}
                    <img 
                      src="{% url 'serve_small_bilder' bild_gallery.id %}"
                      data-full-src="{% url 'serve_bilder' bild_gallery.id %}"
                      alt="{{ bild_gallery.titel }}"
                      class="w-100 rounded border main-image js-progressive-image mb-2"
                      style="max-width: 100%; height: auto;"
                    />
                {% endfor %}
            </div>
          </div>

          <!-- User Info and Interactions Right -->
          <div class="col-lg-4 order-1 order-lg-2">
            <div class="card border-0">
              <div class="card-body p-0">
                {% include 'components/image_card_header.html' with hide_title=True %}

                <!-- Title and Description -->
                <div class="mb-3 mt-3">
                  <h4 class="mb-2">{{ bild.titel }}</h4>
                  {% if bild.beschreibung %}
                    <p class="text-muted">{{ bild.beschreibung }}</p>
                  {% endif %}
                </div>

                <div class="d-none d-lg-block">
                  {% include 'components/image_interactions.html' %}
                </div>
              </div>
            </div>
          </div>

            <div class="order-3 order-lg-2 d-lg-none">
              <!-- Interactions -->
              <div class="card border-0">
                <div class="card-body p-0 pt-3">
                  {% include 'components/image_interactions.html' %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{% static 'js/image-interactions.js' %}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var images = document.querySelectorAll('.js-progressive-image');
      images.forEach(function (img) {
        var fullSrc = img.getAttribute('data-full-src');
        if (!fullSrc) return;
        var loader = new Image();
        loader.onload = function () {
          // Swap to full-res image once loaded
          img.src = fullSrc;
        };
        loader.src = fullSrc;
      });
    });
  </script>
{% endblock %}
