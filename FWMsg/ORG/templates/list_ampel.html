{% extends "baseOrg.html" %}
{% load static %}
{% load ampel_tags %}

{% block title %}Ampelmeldungen{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/list_ampel.css' %}">
{% endblock %}

{% block content %}
    <h2>Ampel Ãœbersicht</h2>
    
    {% for jahrgang, fw_matrix in ampel_matrix.items %}
        <div class="jahrgang-section">
            <button class="btn btn-secondary w-100 mb-2" type="button" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#jahrgang-{{ jahrgang.id }}" 
                    aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" 
                    aria-controls="jahrgang-{{ jahrgang.id }}">
                {{ jahrgang }}
            </button>
            
            <div class="collapse {% if forloop.first %}show{% endif %}" id="jahrgang-{{ jahrgang.id }}">
                <div class="table-responsive mb-4">
                    <table class="ampel-table">
                        <thead>
                            <tr>
                                <th>Freiwilliger</th>
                                {% for month in months %}
                                    <th {% if month == current_month %}class="current-month"{% endif %}>
                                        {{ month }}
                                    </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for freiwilliger, months_data in fw_matrix.items %}
                                <tr>
                                    <td>{{ freiwilliger }}</td>
                                    {% for month in months %}
                                        <td {% if month == current_month %}class="current-month"{% endif %}>
                                            <div class="ampel-dot-container">
                                                {% for entry in months_data|get_item:month %}
                                                    <span class="ampel-dot ampel-{{ entry.status }}">
                                                        <div class="ampel-tooltip">
                                                            <strong>{{ entry.date }}</strong><br>
                                                            {{ entry.comment }}
                                                        </div>
                                                    </span>
                                                {% endfor %}
                                            </div>
                                        </td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}