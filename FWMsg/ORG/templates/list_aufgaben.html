{% extends "baseOrg.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Aufgaben" %}{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/list_aufgaben.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Open Tasks -->
    <div class="card rounded-4 mb-4">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center py-3">
            <h4 class="mb-0">{% trans "Fällige Aufgaben" %}</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>{% trans "Freiwilliger" %}</th>
                            <th>{% trans "Aufgabe" %}</th>
                            <th>{% trans "Fällig" %}</th>
                            <th>{% trans "Beschreibung" %}</th>
                            <th>{% trans "Aktion" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for aufgabe in aufgaben_unfinished %}
                            <tr>
                                <td>{{ aufgabe.freiwilliger }}</td>
                                <td>{{ aufgabe.aufgabe }}</td>
                                <td>{{ aufgabe.faellig|date:"d.m.y" }}</td>
                                <td>{{ aufgabe.beschreibung }}</td>
                                <td>
                                    <form method="post" class="d-inline">
                                        {% csrf_token %}
                                        <input type="hidden" name="aufgabe_id" value="{{ aufgabe.id }}">
                                        <input type="hidden" name="reminder" value="False">
                                        <button type="submit" class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-bell me-1"></i>{% trans "Erinnerung" %}
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pending Tasks -->
    <div class="card rounded-4 mb-4">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center py-3">
            <h4 class="mb-0">{% trans "Pending Aufgaben" %}</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>{% trans "Freiwilliger" %}</th>
                            <th>{% trans "Aufgabe" %}</th>
                            <th>{% trans "Fällig" %}</th>
                            <th>{% trans "Beschreibung" %}</th>
                            <th>{% trans "Aktion" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for aufgabe in aufgaben_pending %}
                            <tr>
                                <td>{{ aufgabe.freiwilliger }}</td>
                                <td>{{ aufgabe.aufgabe }}</td>
                                <td>{{ aufgabe.faellig|date:"d.m.y" }}</td>
                                <td>{{ aufgabe.beschreibung }}</td>
                                <td>
                                    <form method="post" class="d-inline me-1">
                                        {% csrf_token %}
                                        <input type="hidden" name="aufgabe_id" value="{{ aufgabe.id }}">
                                        <input type="hidden" name="pending" value="False">
                                        <input type="hidden" name="erledigt" value="True">
                                        <button type="submit" class="btn btn-success btn-sm">
                                            <i class="bi bi-check-lg me-1"></i>{% trans "Erledigt" %}
                                        </button>
                                    </form>
                                    <button class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-eye me-1"></i>{% trans "Einsicht" %}
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Completed Tasks -->
    <div class="card rounded-4 mb-4">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center py-3">
            <h4 class="mb-0">{% trans "Erledigte Aufgaben" %}</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>{% trans "Freiwilliger" %}</th>
                            <th>{% trans "Aufgabe" %}</th>
                            <th>{% trans "Beschreibung" %}</th>
                            <th>{% trans "Erledigt am" %}</th>
                            <th>{% trans "Aktion" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for aufgabe in aufgaben_erledigt %}
                            <tr>
                                <td>{{ aufgabe.freiwilliger }}</td>
                                <td>{{ aufgabe.aufgabe }}</td>
                                <td>{{ aufgabe.beschreibung }}</td>
                                <td>{{ aufgabe.erledigt_am|date:"d.m.y" }}</td>
                                <td>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-three-dots"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <form method="post">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="aufgabe_id" value="{{ aufgabe.id }}">
                                                    <input type="hidden" name="pending" value="False">
                                                    <input type="hidden" name="erledigt" value="False">
                                                    <button type="submit" class="dropdown-item">
                                                        <i class="bi bi-arrow-counterclockwise me-1"></i>{% trans "Als unerledigt markieren" %}
                                                    </button>
                                                </form>
                                            </li>
                                            <li>
                                                <form method="post">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="aufgabe_id" value="{{ aufgabe.id }}">
                                                    <input type="hidden" name="pending" value="True">
                                                    <input type="hidden" name="erledigt" value="False">
                                                    <button type="submit" class="dropdown-item">
                                                        <i class="bi bi-hourglass-split me-1"></i>{% trans "Als pending markieren" %}
                                                    </button>
                                                </form>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li>
                                                <button class="dropdown-item">
                                                    <i class="bi bi-eye me-1"></i>{% trans "Einsicht" %}
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}