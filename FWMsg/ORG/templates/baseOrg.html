{# Base template that all other templates inherit from #}
{% load static %}
{% load base_filter %}
{% load base_fw_filter %}
{% load base_org_filter %}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'header.html' %}

    <title>
      {% block title %}
        FWMsg
      {% endblock %}
    </title>

    <script src="{% static 'js/baseOrg.js' %}"></script>

    {% block head %}

    {% endblock %}
  </head>
  <body>
    <div class="d-flex">
      {# Main Navigation Bar #}
      <div class="content w-100">
        <nav class="navbar bg-primary navbar-expand-md">
          <div class="container-fluid">
            {# Organization Logo and Name #}
            <a class="navbar-brand" href="{% url 'org_home' %}">
              {% with org=user|get_org %}
                <img src="{% url 'serve_image' org.id %}"
                  alt="{% if org.kurzname %}
                    {{ org.kurzname }}
                  {% else %}
                    {{ org.name }}
                  {% endif %}-Logo"
                  height="30"
                  class="d-inline-block align-text-top" />
              {% endwith %}
            </a>

            {# Mobile Navigation Toggle Button #}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

            {# Navigation Links #}
            <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                  <a href="{% url 'org_home' %}" class="nav-link" aria-current="page">Home</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Tabellen</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a href="{% url 'list_object' 'freiwilliger' %}" class="dropdown-item">Freiwillige</a>
                    <a href="{% url 'list_object' 'notfallkontakt' %}" class="dropdown-item">Notfallkontakte</a>
                    <a href="{% url 'list_object' 'team' %}" class="dropdown-item">Team</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'list_ampel' %}" class="dropdown-item">Ampelmeldungen</a>
                    <a href="{% url 'list_aufgaben_table' %}" class="dropdown-item">Aufgabenübersicht</a>
                    <a href="{% url 'list_object' 'aufgabe' %}" class="dropdown-item">Aufgaben</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'list_object' 'einsatzland' %}" class="dropdown-item">Einsatzländer</a>
                    <a href="{% url 'list_object' 'einsatzstelle' %}" class="dropdown-item">Einsatzstellen</a>
                  </div>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Einstellungen</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a href="{% url 'list_object' 'aufg-filter' %}" class="dropdown-item">Aufgaben Filter</a>
                    <a href="{% url 'list_object' 'attribute' %}" class="dropdown-item">Attribute</a>
                    <a href="{% url 'list_object' 'user' %}" class="dropdown-item">Benutzer:innen</a>
                    <a href="{% url 'list_object' 'personcluster' %}" class="dropdown-item">Benutzergruppen</a>
                  </div>
                </li>
                <li>
                  <a href="{% url 'bilder' %}" class="nav-link">Bilder</a>
                </li>
                <li>
                  <a href="{% url 'dokumente' %}" class="nav-link">Dokumente</a>
                </li>
              </ul>

              <div class="d-flex flex-wrap gap-2 justify-content-center align-items-center">
                <!-- Language Selector -->
                {% include 'components/language_selector.html' %}

                <!-- Person Cluster Selector -->
                {% include 'components/person_cluster_selector.html' %}

                <!-- Profil Button -->
                <div class="d-flex">
                  <a href="{% url 'profil' %}" class="btn btn-light"><i class="bi bi-person me-1"></i></a>
                </div>
              </div>
            </div>
          </div>
        </nav>

        {# Main Content Area #}
        <div class="container-fluid mt-3 mb-5">
          {% include 'error_message.html' %}
          {% block content %}

          {% endblock %}
        </div>
      </div>
    </div>

    {% block footer %}

    {% endblock %}

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Handle person cluster selection
        document.querySelectorAll('[data-person-cluster]').forEach((item) => {
          item.addEventListener('click', function (e) {
            e.preventDefault()
            const personClusterId = this.dataset.personCluster
            const personClusterName = this.textContent.trim()
      
            // Save to cookies
            if (personClusterId) {
              Cookies.set('selectedPersonCluster', personClusterId, { expires: 365 })
              Cookies.set('selectedPersonClusterName', personClusterName, { expires: 365 })
            } else {
              Cookies.remove('selectedPersonCluster')
              Cookies.remove('selectedPersonClusterName')
            }
      
            // Update dropdown text
            document.getElementById('selectedPersonCluster').textContent = personClusterName
      
            // Reload current page
            window.location.reload()
          })
        })
      })
    </script>
  </body>
</html>
