{# Base template that all other templates inherit from #}
{% load static %}
{% load base_filter %}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'header.html' %}

    <title>
      {% block title %}
        Volunteer.Solutions
      {% endblock %}
    </title>

    <script src="{% static 'js/baseOrg.js' %}"></script>
    
    {# Include ORG-specific CSS #}
    <link rel="stylesheet" href="{% static 'css/baseOrg.css' %}">

    {% block head %}

    {% endblock %}
  </head>
  <body>
    <div class="d-flex">
      {# Main Navigation Bar #}
      <div class="content w-100">
        <nav class="navbar bg-primary navbar-expand-lg">
          <div class="container-fluid">
            {# Organization Logo and Name #}
            <a class="navbar-brand" href="{% url 'org_home' %}">
              {% with org=user|get_org %}
                <img src="{% url 'serve_image' org.id %}"
                  alt="{% if org.kurzname %}
                    {{ org.kurzname }}
                  {% else %}
                    {{ org.name }}
                  {% endif %}-Logo"
                  height="30"
                  class="d-inline-block align-text-top" />
              {% endwith %}
            </a>

            {# Mobile Navigation Toggle Button #}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

            {# Navigation Links #}
            <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                  <a href="{% url 'org_home' %}" class="nav-link" aria-current="page">
                    <i class="bi bi-house me-1"></i>{% trans "Home" %}
                  </a>
                </li>
                
                {# People Management Dropdown #}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="peopleDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-people me-1"></i>{% trans "Personen" %}
                  </a>
                  <div class="dropdown-menu dropdown-menu-wide" aria-labelledby="peopleDropdown">
                    <a href="{% url 'list_object' 'freiwilliger' %}" class="dropdown-item">
                      <i class="bi bi-person me-2"></i>{% trans "Freiwillige" %}
                    </a>
                    <a href="{% url 'list_object' 'team' %}" class="dropdown-item">
                      <i class="bi bi-people me-2"></i>{% trans "Team" %}
                    </a>
                    <a href="{% url 'list_object' 'ehemalige' %}" class="dropdown-item">
                      <i class="bi bi-person-check me-2"></i>{% trans "Ehemalige" %}
                    </a>
                    <a href="{% url 'list_object' 'bewerber' %}" class="dropdown-item">
                      <i class="bi bi-person-vcard me-2"></i>{% trans "Bewerber:innen" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'list_object' 'notfallkontakt' %}" class="dropdown-item">
                      <i class="bi bi-telephone me-2"></i>{% trans "Notfallkontakte" %}
                    </a>
                  </div>
                </li>

                {# Task Management Dropdown #}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="tasksDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-list-check me-1"></i>{% trans "Aufgaben" %}
                  </a>
                  <div class="dropdown-menu dropdown-menu-wide" aria-labelledby="tasksDropdown">
                    <a href="{% url 'list_aufgaben_table' %}" class="dropdown-item">
                      <i class="bi bi-grid me-2"></i>{% trans "Aufgabenübersicht" %}
                    </a>
                    <a href="{% url 'list_object' 'aufgabe' %}" class="dropdown-item">
                      <i class="bi bi-list-ul me-2"></i>{% trans "Aufgabenliste" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'list_ampel' %}" class="dropdown-item">
                      <i class="bi bi-stoplights me-2"></i>{% trans "Ampelmeldungen" %}
                    </a>
                  </div>
                </li>

                {# Content Management Dropdown #}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="contentDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-folder me-1"></i>{% trans "Inhalte" %}
                  </a>
                  <div class="dropdown-menu dropdown-menu-wide" aria-labelledby="contentDropdown">
                    <a href="{% url 'dokumente' %}" class="dropdown-item">
                      <i class="bi bi-file-text me-2"></i>{% trans "Dokumente" %}
                    </a>
                    <a href="{% url 'bilder' %}" class="dropdown-item">
                      <i class="bi bi-image me-2"></i>{% trans "Bilder" %}
                    </a>
                    <a href="{% url 'posts_overview' %}" class="dropdown-item">
                      <i class="bi bi-journal-text me-2"></i>{% trans "Posts" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'kalender' %}" class="dropdown-item">
                      <i class="bi bi-calendar-date me-2"></i>{% trans "Kalender" %}
                    </a>
                    <a href="{% url 'list_object' 'kalender' %}" class="dropdown-item">
                      <i class="bi bi-calendar-week me-2"></i>{% trans "Kalenderliste" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'list_object' 'einsatzland' %}" class="dropdown-item">
                      <i class="bi bi-globe me-2"></i>{% trans "Einsatzländer" %}
                    </a>
                    <a href="{% url 'list_object' 'einsatzstelle' %}" class="dropdown-item">
                      <i class="bi bi-building me-2"></i>{% trans "Einsatzstellen" %}
                    </a>
                    {% comment %} <a href="{% url 'einsatzstellen_notiz' %}" class="dropdown-item">
                      <i class="bi bi-sticky me-2"></i>{% trans "Einsatzstellen Notizen" %}
                    </a> {% endcomment %}
                    <a href="{% url 'change_requests' %}" class="dropdown-item">
                      <i class="bi bi-arrow-repeat me-2"></i>{% trans "Änderungsvorschläge" %}
                    </a>
                  </div>
                </li>

                {# Administration Dropdown #}
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-gear me-1"></i>{% trans "Einstellungen" %}
                  </a>
                  <div class="dropdown-menu dropdown-menu-wide" aria-labelledby="adminDropdown">
                    <a href="{% url 'list_object' 'user' %}" class="dropdown-item">
                      <i class="bi bi-person-gear me-2"></i>{% trans "Benutzer:innen" %}
                    </a>
                    <a href="{% url 'list_object' 'personcluster' %}" class="dropdown-item">
                      <i class="bi bi-diagram-3 me-2"></i>{% trans "Benutzergruppen" %}
                    </a>
                    <a href="{% url 'list_object' 'attribute' %}" class="dropdown-item">
                      <i class="bi bi-tags me-2"></i>{% trans "Attribute" %}
                    </a>
                    <a href="{% url 'list_object' 'aufg-filter' %}" class="dropdown-item">
                      <i class="bi bi-funnel me-2"></i>{% trans "Aufgabenfilter" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'application_overview' %}" class="dropdown-item">
                      <i class="bi bi-file-earmark-person me-2"></i>{% trans "Bewerbungen" %}
                    </a>
                    <a href="{% url 'seminar_home' %}" class="dropdown-item">
                      <i class="bi bi-mortarboard me-2"></i>{% trans "Seminar" %}
                    </a>
                    <a href="{% url 'survey:survey_list' %}" class="dropdown-item">
                      <i class="bi bi-bar-chart me-2"></i>{% trans "Umfragen" %}
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'copy_links' %}" class="dropdown-item">
                      <i class="bi bi-link-45deg me-2"></i>{% trans "Links kopieren" %}
                    </a>
                  </div>
                </li>
              </ul>

              <div class="d-flex flex-wrap gap-2 justify-content-center align-items-center">
                
                <!-- Person Cluster Selector -->
                {% include 'components/person_cluster_selector.html' %}
                
                <!-- Settings Button -->
                <a href="{% url 'settings' %}" class="btn btn-light"><i class="bi bi-gear"></i></a>

                <!-- Profil Button -->
                <a href="{% url 'profil' %}" class="btn btn-light"><i class="bi bi-person"></i></a>

                {% if user.is_superuser %}
                  <a href="{% url 'admin:index' %}" class="btn btn-secondary"><i class="bi bi-person-gear"></i></a>
                {% endif %}
              </div>
            </div>
          </div>
        </nav>

        {# Main Content Area #}
        <div class="{% if large_container %}container-fluid{% else %}container{% endif %} mt-3 mb-5">
          {% include 'error_message.html' %}
          {% block content %}

          {% endblock %}
        </div>
      </div>
    </div>

    {% block footer %}

    {% endblock %}

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Handle person cluster selection
        document.querySelectorAll('[data-person-cluster]').forEach((item) => {
          item.addEventListener('click', function (e) {
            e.preventDefault()
            const personClusterId = this.dataset.personCluster
            const personClusterName = this.textContent.trim()
      
            // Save to cookies
            if (personClusterId) {
              Cookies.set('selectedPersonCluster', personClusterId, { expires: 365 })
              Cookies.set('selectedPersonClusterName', personClusterName, { expires: 365 })
            } else {
              Cookies.remove('selectedPersonCluster')
              Cookies.remove('selectedPersonClusterName')
            }
      
            // Update dropdown text
            document.getElementById('selectedPersonCluster').textContent = personClusterName
      
            // Reload current page
            window.location.reload()
          })
        })
      })
    </script>
  </body>
</html>
