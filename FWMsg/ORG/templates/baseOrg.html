{# Base template that all other templates inherit from #}
{% load static %}
{% load base_filter %}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'header.html' %}

    <title>
      {% block title %}
        Volunteer.Solutions
      {% endblock %}
    </title>

    <script src="{% static 'js/baseOrg.js' %}"></script>

    {% block head %}

    {% endblock %}
  </head>
  <body>
    <div class="d-flex">
      {# Main Navigation Bar #}
      <div class="content w-100">
        <nav class="navbar bg-primary navbar-expand-lg">
          <div class="container-fluid">
            {# Organization Logo and Name #}
            <a class="navbar-brand" href="{% url 'org_home' %}">
              {% with org=user|get_org %}
                <img src="{% url 'serve_image' org.id %}"
                  alt="{% if org.kurzname %}
                    {{ org.kurzname }}
                  {% else %}
                    {{ org.name }}
                  {% endif %}-Logo"
                  height="30"
                  class="d-inline-block align-text-top" />
              {% endwith %}
            </a>

            {# Mobile Navigation Toggle Button #}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

            {# Navigation Links #}
            <div class="collapse navbar-collapse" id="navbarResponsive">
              <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                  <a href="{% url 'org_home' %}" class="nav-link" aria-current="page">{% trans "Home" %}</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">{% trans "Tabellen" %}</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a href="{% url 'list_object' 'freiwilliger' %}" class="dropdown-item">{% trans "Freiwillige" %}</a>
                    <a href="{% url 'list_object' 'notfallkontakt' %}" class="dropdown-item">{% trans "Notfallkontakte" %}</a>
                    <a href="{% url 'list_object' 'team' %}" class="dropdown-item">{% trans "Team" %}</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'list_object' 'aufgabe' %}" class="dropdown-item">{% trans "Aufgaben" %}</a>
                    <a href="{% url 'list_aufgaben_table' %}" class="dropdown-item">{% trans "Aufgabenübersicht" %}</a>
                    <a href="{% url 'list_ampel' %}" class="dropdown-item">{% trans "Ampelmeldungen" %}</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'list_object' 'einsatzland' %}" class="dropdown-item">{% trans "Einsatzländer" %}</a>
                    <a href="{% url 'list_object' 'einsatzstelle' %}" class="dropdown-item">{% trans "Einsatzstellen" %}</a>
                    <a href="{% url 'einsatzstellen_notiz' %}" class="dropdown-item">{% trans "Einsatzstellen Notizen" %}</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'list_object' 'kalender' %}" class="dropdown-item">{% trans "Kalender-Termine" %}</a>
                  </div>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">{% trans "Einstellungen" %}</a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a href="{% url 'list_object' 'user' %}" class="dropdown-item">{% trans "Benutzer:innen" %}</a>
                    <a href="{% url 'list_object' 'personcluster' %}" class="dropdown-item">{% trans "Benutzergruppen" %}</a>
                    <a href="{% url 'list_object' 'attribute' %}" class="dropdown-item">{% trans "Attribute" %}</a>
                    <a href="{% url 'list_object' 'aufg-filter' %}" class="dropdown-item">{% trans "Aufgaben Filter" %}</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'application_overview' %}" class="dropdown-item">{% trans "Bewerbungen" %}</a>
                    <a href="{% url 'seminar_home' %}" class="dropdown-item">{% trans "Seminar" %}</a>
                    <a href="{% url 'survey:survey_list' %}" class="dropdown-item">{% trans "Umfragen" %}</a>
                    <hr class="dropdown-divider" />
                    <a href="{% url 'copy_links' %}" class="dropdown-item">{% trans "Links kopieren" %}</a>
                  </div>
                </li>
                <li>
                  <a href="{% url 'kalender' %}" class="nav-link">{% trans "Kalender" %}</a>
                </li>
                <li>
                  <a href="{% url 'bilder' %}" class="nav-link">{% trans "Bilder" %}</a>
                </li>
                <li>
                  <a href="{% url 'dokumente' %}" class="nav-link">{% trans "Dokumente" %}</a>
                </li>
              </ul>

              <div class="d-flex flex-wrap gap-2 justify-content-center align-items-center">
                
                <!-- Person Cluster Selector -->
                {% include 'components/person_cluster_selector.html' %}
                
                <!-- Settings Button -->
                <a href="{% url 'settings' %}" class="btn btn-light"><i class="bi bi-gear"></i></a>

                <!-- Profil Button -->
                <a href="{% url 'profil' %}" class="btn btn-light"><i class="bi bi-person"></i></a>

                {% if user.is_superuser %}
                  <a href="{% url 'admin:index' %}" class="btn btn-secondary"><i class="bi bi-person-gear"></i></a>
                {% endif %}
              </div>
            </div>
          </div>
        </nav>

        {# Main Content Area #}
        <div class="{% if large_container %}container-fluid{% else %}container{% endif %} mt-3 mb-5">
          {% include 'error_message.html' %}
          {% block content %}

          {% endblock %}
        </div>
      </div>
    </div>

    {% block footer %}

    {% endblock %}

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })

        // Handle person cluster selection
        document.querySelectorAll('[data-person-cluster]').forEach((item) => {
          item.addEventListener('click', function (e) {
            e.preventDefault()
            const personClusterId = this.dataset.personCluster
            const personClusterName = this.textContent.trim()
      
            // Save to cookies
            if (personClusterId) {
              Cookies.set('selectedPersonCluster', personClusterId, { expires: 365 })
              Cookies.set('selectedPersonClusterName', personClusterName, { expires: 365 })
            } else {
              Cookies.remove('selectedPersonCluster')
              Cookies.remove('selectedPersonClusterName')
            }
      
            // Update dropdown text
            document.getElementById('selectedPersonCluster').textContent = personClusterName
      
            // Reload current page
            window.location.reload()
          })
        })
      })
    </script>
  </body>
</html>
