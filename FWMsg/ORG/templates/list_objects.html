{% extends "baseOrg.html" %}
{% load list_objects_filters %}
{% load i18n %}

{% block head %}
<style>
    .table td:last-child {
        background: white;
        z-index: 1;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-between mb-3 align-items-center">
    <div class="col d-flex justify-content-between align-items-center">
        <div class="">
            <h2>{{ verbose_name }}</h2>
        </div>

        <div class="">
            <a href="{% url 'add_object' model_name %}">
                <button class="btn btn-primary">
                    <i class="bi bi-plus-lg me-1"></i>Hinzuf√ºgen
                </button>
            </a>
        </div>
    </div>

    <div class="col-md-6 col-lg-5 col-xl-4 col-sm-12 mt-1">
        <div class="input-group">
            <input type="text" class="form-control" id="mySearch" placeholder="Suche">
            <button class="btn btn-outline-primary" type="button">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </div>
</div>

{% include "filter_form.html" %}

<div class="card rounded-4 p-1">
    <div class="table-responsive rounded-4">
        <table class="table table-hover mb-0 align-middle">
            <thead>
                <tr>
                    {% for field in field_metadata %}
                    <th>{{ field.verbose_name }}</th>
                    {% endfor %}
                    <th class="position-sticky" style="right: 0; background: white;"></th>
                </tr>
            </thead>
            <tbody id="myTable">
                {% for object in objects %}
                <tr data-pk="{{ object.pk }}">
                    {% for field in field_metadata %}
                    <td data-default="{{ object|get_attribute:field.name|default:'' }}" data-field="{{ field.name }}">
                        {% if object|is_many_to_many:field.name %}
                        {% with items=object|get_attribute:field.name %}
                        {{ items.all|join:", " }}
                        {% endwith %}
                        {% else %}
                        {% if object|get_field_type:field.name == 'BooleanField' %}
                        <div class="text-center">
                            {% if object|get_attribute:field.name %}
                            <i class="bi bi-check text-white bg-success rounded"></i>
                            {% endif %}
                        </div>
                        {% elif object|get_field_type:field.name == 'CharField' and
                        object|get_attribute:field.name|length == 1 %}
                        <div class="text-center">
                            {{ object|get_attribute:field.name|default:'' }}
                        </div>
                        {% elif object|get_field_type:field.name == 'DateField' or object|get_field_type:field.name ==
                        'DateTimeField' %}
                        {{ object|get_attribute:field.name|date:"d.m.Y"|default:'' }}
                        {% else %}
                        {{ object|get_attribute:field.name|default:'' }}
                        {% endif %}
                        {% endif %}
                    </td>
                    {% endfor %}
                    <td class="position-sticky" style="right: 0">
                        <div class="btn-group">
                            <a class="btn btn-sm btn-outline-primary"
                                href="{% url 'edit_object' model_name object.pk %}">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a class="btn btn-sm btn-outline-danger"
                                href="{% url 'delete_object' model_name object.pk %}"
                                onclick="return confirm('{% trans 'Are you sure you want to delete this item?' %}')">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="{{ field_metadata|length|add:1 }}" class="text-center">
                        {% trans "No items found" %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#mySearch").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            console.log(value);
            $("#myTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
{% endblock %}