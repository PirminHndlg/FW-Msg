{% load i18n %}

<tr class="">
  <th class="p-0 sticky-top with-border">
    <div class="d-flex gap-1 align-items-center justify-content-between pe-0">
      {{current_person_cluster|default:'Person'}}
    </div>
    <div class="search-container mt-2">
      <div class="input-group">
        <input type="text" id="userSearch" class="form-control" placeholder="{% trans 'Suchen...' %}" aria-label="{% trans 'Benutzer suchen' %}">
      </div>
    </div>
    <hr class="border-dark m-0 mt-1" />
  </th>
  {% for aufgabe in aufgaben %}
    <th class="text-center bg-white p-0 sticky-top with-border">
      <div class="d-flex gap-1 align-items-center">
        <div class="d-flex gap-0 align-items-center flex-column">
          {% if aufgabe.beschreibung %}
            <a class="btn p-0" data-bs-toggle="tooltip" data-bs-title="{% trans 'Beschreibung' %}: {{ aufgabe.beschreibung }}"><i class="bi bi-info-circle"></i></a>
          {% endif %}
          {% if aufgabe.mitupload %}
            <a class="btn p-0" data-bs-toggle="tooltip" data-bs-title="{% trans 'Diese Aufgabe erfordert eine Datei' %}"><i class="bi bi-file-earmark-arrow-up text-success"></i></a>
          {% endif %}
          {% if aufgabe.wiederholung %}
            <a class="btn p-0" data-bs-toggle="tooltip" data-bs-title="{% trans 'Mit Wiederholung' %}"><i class="bi bi-repeat"></i></a>
          {% endif %}
        </div>

        <div class="dropdown d-inline">
          <button class="btn btn-sm dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false"><p class="text-wrap m-0">{{ aufgabe.name }}</p></button>
          <ul class="dropdown-menu z-1000">
            <li>
              <a href="{% url 'edit_object' 'aufgabe' aufgabe.id %}?next={% url 'list_aufgaben_table' %}" class="dropdown-item"><i class="bi bi-pencil"></i> {% trans 'Bearbeiten' %}</a>
            </li>
            <li>
              <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#taskCountryModal" onclick="setTaskId({{ aufgabe.id }}, '{{ aufgabe.name }}')"><i class="bi bi-globe-americas"></i> {% trans 'Einem Einsatzland zuweisen' %}</a>
            </li>
            <li>
              <button type="button" class="dropdown-item" onclick="assignTaskToAll('{{ aufgabe.id }}')">
                <i class="bi bi-people-fill"></i> {% trans 'Allen Freiwilligen zuweisen' %}
              </button>
            </li>
          </ul>
        </div>
      </div>
      <hr class="border-dark m-0 mt-1" />
    </th>
  {% endfor %}
  <th class="p-0 sticky-right with-border-before">
    <div class="d-flex gap-1 align-items-center">
      <a href="{% url 'add_aufgabe' %}?next={% url 'list_aufgaben_table' %}" class="btn px-4" data-bs-toggle="tooltip" data-bs-title="{% trans 'Neue Aufgabe erstellen' %}"><i class="bi bi-plus-circle"></i></a>
      <div class="vr border-dark m-0 ms-1 me-1" style="height: 70px; width: 0;"></div>
    </div>
    <hr class="border-dark m-0 mt-1" />
  </th>
</tr>

<style>
  @media (min-width: 768px) {
  .sticky-right {
    position: sticky;
      right: 0;
      background-color: var(--bs-body-bg); 
      z-index: 1;
    }
  }

  .sticky-top {
    position: sticky;
    top: 0;
    z-index: 1020;
  }
  
  /* Ensure borders remain visible when scrolling */
  .border-bottom {
    border-bottom-width: 1px !important;
    border-bottom-style: solid !important;
  }
  
  .border-end {
    border-right-width: 1px !important;
    border-right-style: solid !important;
  }
  
  th.with-border::after {
    content: '';
    position: absolute;
    top: 0;
    right: 1px;
    bottom: 0;
    width: 1px;
    background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));
    color: rgba(var(--bs-dark-rgb), var(--bs-border-opacity));
  }

  th.with-border-before::before {
    content: '';
    position: absolute;
    top: 0;
    left: 1px;
    bottom: 0;
    width: 1px;
    background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));
    color: rgba(var(--bs-dark-rgb), var(--bs-border-opacity));
  }
  
  .z-1000 {
    z-index: 1000;
  }

  /* Search container styles */
  .search-container {
    position: sticky;
    top: 0;
    z-index: 1021;
    background-color: var(--bs-body-bg);
  }

  .search-container .input-group {
    width: 100%;
  }

  .search-container .input-group-text {
    background-color: var(--bs-body-bg);
  }
</style>
