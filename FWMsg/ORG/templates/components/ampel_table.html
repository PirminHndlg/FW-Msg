{% load i18n %}
{% load base_filter %}

<div class="table-responsive" style="height: 80vh; min-height: 400px;">
    <table class="table mb-0 align-middle m-1">
        <tr class="sticky-top bg-white">
            <th class="border-end sticky-col bg-transparent"></th>
            {% for month in months %}
            <th class="text-center {% if month == current_month %}table-active{% endif %}"
                style="min-width: 100px;">
                {{ month }}
            </th>
            {% endfor %}
        </tr>
        <tbody>
            {% for person_cluster, user_matrix in ampel_matrix.items %}
            {% for user, months_data in user_matrix.items %}
            <tr>
                <th class="border-end sticky-col">
                    <a class="text-decoration-none text-body" data-bs-toggle="tooltip"
                        title="{% trans 'Historie anzeigen' %}">
                        {{ user.first_name }} {{   user.last_name }}
                    </a>
                </th>
                {% for month in months %}
                <td class="text-center {% if month == current_month %}table-active{% endif %}">
                    <div class="ampel-dot-container">
                        {% for entry in months_data|get_item:month %}
                        <span class="ampel-dot ampel-{{ entry.status }}"
                            onclick="showAmpelComment('{{ entry.date }}', '{{ entry.status }}', '{{ entry.comment|default:'-ohne Kommentar- '|escapejs }}')"
                            data-bs-toggle="tooltip" data-bs-html="true"
                            title="<strong>{{ entry.date }}</strong><br>{{ entry.comment|default:'' }}">
                        </span>
                        {% endfor %}
                    </div>
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .sticky-top {
        position: sticky;
        top: 0;
        z-index: 20;
    }
</style>

{% if not ampel_matrix %}
<div class="alert alert-info mt-4">
    {% trans "Keine Ampelmeldungen gefunden." %}
</div>
{% endif %} 