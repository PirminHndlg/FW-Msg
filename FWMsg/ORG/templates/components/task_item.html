{% load i18n %}

{% for task in tasks %}
  <div class="list-group-item">
    <div class="d-flex w-100 justify-content-between align-items-center">
      <div>
        <h6 class="mb-1">{{ task.aufgabe }}</h6>
        <p class="mb-1 text-muted">{{ task.user.first_name }} {{ task.user.last_name }}</p>
      </div>

      <div class="d-flex align-items-center gap-2">
        {% if task.pending %}
          {% if task.file %}
            <a href="{% url 'download_aufgabe' task.id %}"
              class="btn btn-sm btn-outline-primary download-btn mt-1"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="{% if task.file_downloaded_of.count > 0 %}
                {% trans 'Heruntergeladen von' %}
                {% for user in task.file_downloaded_of.all %}
                  {{ user.first_name }} {{ user.last_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              {% else %}
                {% trans 'Noch nicht heruntergeladen' %}
              {% endif %}">
              <i class="bi bi-download"></i>
            </a>
          {% endif %}
        {% endif %}

        <span class="badge badge-pill {% if not task.pending %}
            bg-danger
          {% elif task.pending %}
            bg-warning
          {% else %}
            bg-success
          {% endif %}">
          {{ task.faellig|date:'d.m.y'|default:'flexibel' }}
        </span>
      </div>
    </div>
  </div>
{% endfor %}
