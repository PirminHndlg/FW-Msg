{% extends 'baseBw.html' %}
{% load i18n %}

{% block title %}
  Meine Antworten
{% endblock %}

{% block content %}
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <div class="card rounded-4 shadow-sm">
          <div class="card-header bg-light rounded-top-4 py-3">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <div class="answer-icon bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-list-check text-white fs-5"></i>
                </div>
                <h3 class="card-title mb-0 fw-semibold">Meine Antworten</h3>
              </div>
              <div class="d-flex gap-2">
                <a href="{% url 'bw_home' %}" class="btn btn-primary rounded-3"><i class="bi bi-house me-2"></i>Zurück zur Startseite</a>
              </div>
            </div>
          </div>
          <div class="card-body p-4">
            {% if answers %}
              <div class="list-group list-group-flush">
                {% for answer in answers %}
                  <div class="list-group-item px-0 py-4">
                    <div class="d-flex align-items-start">
                      <div class="question-number bg-light rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 32px; height: 32px;">
                        <span class="fw-semibold">{{ answer.question.order }}</span>
                      </div>
                      <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h5 class="mb-1">{{ answer.question.question }}</h5>
                          <a href="{% url 'bw_application_answer' answer.question.id %}" class="btn btn-sm btn-outline-primary rounded-3 {% if user.bewerber.abgeschlossen %}disabled{% endif %}"><i class="bi bi-pencil me-1"></i>Bearbeiten</a>
                        </div>
                        {% if answer.question.description %}
                          <p class="text-muted small mb-3">{{ answer.question.description }}</p>
                        {% endif %}
                        <div class="answer-content p-3 bg-light rounded-3">{{ answer.answer|linebreaks }}</div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="alert alert-info rounded-3">
                <div class="d-flex">
                  <div class="me-3">
                    <i class="bi bi-info-circle-fill fs-4"></i>
                  </div>
                  <div>
                    <h5 class="alert-heading mb-2">Keine Antworten vorhanden</h5>
                    <p class="mb-0">Sie haben noch keine Fragen beantwortet. Gehen Sie zurück zur Fragenliste, um Ihre Bewerbung zu vervollständigen.</p>
                  </div>
                </div>
              </div>
            {% endif %}
            {% if file_answers %}
              <div class="list-group list-group-flush">
                {% for answer in file_answers %}
                  <div class="list-group-item px-0 py-4">
                    <div class="d-flex align-items-start">
                      <div class="question-number bg-light rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 32px; height: 32px;">
                        <span class="fw-semibold">{{ answer.file_question.order }}</span>
                      </div>
                      <div class="flex-grow-1">
                        <h5 class="mb-1">{{ answer.file_question.name }}</h5>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
            <div class="d-flex gap-2 mt-4 justify-content-end">
              <a href="{% url 'bw_home' %}" class="btn btn-outline-primary rounded-3"><i class="bi bi-arrow-left me-2"></i>Zurück zur Startseite</a>
              {% if not user.bewerber.abgeschlossen %}
                <button type="button" class="btn btn-primary rounded-3" data-bs-toggle="modal" data-bs-target="#submitConfirmationModal">
                  <i class="bi bi-send-fill me-2"></i>Bewerbung abschicken
                </button>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Submit Confirmation Modal -->
  <div class="modal fade" id="submitConfirmationModal" tabindex="-1" aria-labelledby="submitConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-semibold" id="submitConfirmationModalLabel">Bewerbung abschließen</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center mb-4">
            <div class="icon-wrapper bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 48px; height: 48px;">
              <i class="bi bi-exclamation-triangle-fill text-warning fs-4"></i>
            </div>
            <div>
              <h5 class="mb-1">Sind Sie sicher?</h5>
              <p class="text-muted mb-0">Bitte überprüfen Sie Ihre Antworten vor dem Absenden.</p>
            </div>
          </div>
          <div class="alert alert-warning border-0 rounded-4">
            <div class="d-flex">
              <i class="bi bi-info-circle-fill me-3 fs-4"></i>
              <div>
                <h6 class="alert-heading mb-1">Wichtige Hinweise:</h6>
                <ul class="mb-0 ps-3">
                  <li>Nach dem Absenden können keine Änderungen mehr vorgenommen werden</li>
                  <li>Bitte stellen Sie sicher, dass alle Antworten vollständig sind</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light rounded-4" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-2"></i>Abbrechen
          </button>
          <a href="{% url 'bw_application_complete' %}" class="btn btn-primary rounded-4">
            <i class="bi bi-send-fill me-2"></i>Ja, Bewerbung absenden
          </a>
        </div>
      </div>
    </div>
  </div>

  <style>
    .list-group-item:not(:last-child) {
      border-bottom: 1px solid var(--bs-gray-200);
    }
    
    .answer-content {
      border-left: 3px solid var(--bs-primary);
    }

    .modal-content {
      border: 1px solid var(--bs-gray-200);
    }
    
    .modal-header {
      padding: 1.5rem 1.5rem 0.5rem;
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .modal-footer {
      padding: 1rem 1.5rem 1.5rem;
    }
    
    .alert ul {
      margin-bottom: 0;
    }
    
    .alert ul li {
      margin-bottom: 0.25rem;
    }
    
    .alert ul li:last-child {
      margin-bottom: 0;
    }
  </style>
{% endblock %}
