{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FW Msg -{% trans 'Passwort ändern' %}</title>

    <link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg" />
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Volunteer.Solutions" />
    <link rel="manifest" href="/favicons/site.webmanifest" />

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap-icons.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/flag-icons.min.css' %}">

    <style>
      body {
        min-height: 100vh;
        background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-primary-rgb) 100%);
      }
      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>

  <body class="container p-4">
    <div class="d-flex align-items-center py-4">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-10 col-lg-8 col-xl-6">
            <div class="card border-0 shadow-lg rounded-4 login-card">
              <div class="card-body p-5">
                <h2 class="fw-bold mb-0">{% trans 'Passwort ändern' %}</h2>
                <p class="text-muted">
                  {% trans 'Bitte geben Sie Ihr aktuelles Passwort und das neue Passwort ein' %}
                </p>

                {% include 'error_message.html' %}

                <!-- Password Change Form -->
                <form method="post">
                  {% csrf_token %}

                  {% if form.errors %}
                    <div class="alert alert-danger" role="alert">
                      {% for field in form %}
                        {% for error in field.errors %}
                          <p>{{ error }}</p>
                        {% endfor %}
                      {% endfor %}
                      {% for error in form.non_field_errors %}
                        <p>{{ error }}</p>
                      {% endfor %}
                    </div>
                  {% endif %}

                  <div class="form-floating mb-3">
                    {{ form.new_password1 }}
                    <label for="{{ form.new_password1.id_for_label }}">{{ form.new_password1.label }}</label>
                  </div>

                  <div class="form-floating mb-4">
                    {{ form.new_password2 }}
                    <label for="{{ form.new_password2.id_for_label }}">{{ form.new_password2.label }}</label>
                  </div>

                  <div class="alert alert-info rounded-3 mb-4">
                    <div class="d-flex">
                      <div class="me-3">
                        <i class="bi bi-shield-check fs-4"></i>
                      </div>
                      <div>
                        <h5 class="alert-heading mb-2">{% trans 'Passwortanforderungen' %}</h5>
                        {{ form.new_password1.help_text }}
                      </div>
                    </div>
                  </div>

                  <div class="alert alert-info rounded-3 mb-4">
                    <div class="d-flex">
                      <div class="me-3">
                        <i class="bi bi-shield-lock fs-4"></i>
                      </div>
                      <div>
                        <h5 class="alert-heading mb-2">{% trans 'Sicherheitstipp' %}</h5>
                        <p class="mb-0">
                          {% trans 'Wir empfehlen die Verwendung von zufälligen, einzigartigen Passwörtern und eines Passwort-Managers.' %}
                          <br>
                          <a href="#" data-bs-toggle="modal" data-bs-target="#passwordManagerModal" class="text-decoration-none">{% trans 'Was ist ein Passwort-Manager?' %}</a>
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="text-center mb-2">
                    <a href="{% url 'index_home' %}" class="text-black">{% trans 'Später ändern' %}</a>
                  </div>

                    <button class="w-100 btn btn-lg btn-primary rounded-3 mb-2" type="submit">{% trans 'Passwort ändern' %}</button>

                </form>

                <!-- Language Selector -->
                <div class="mt-4 text-center">
                  <form action="{% url 'set_language' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}" />

                    {% get_current_language as CURRENT_LANGUAGE %}
                    {% get_available_languages as LANGUAGES %}

                    {% for lang_code, lang_name in LANGUAGES %}
                      <button type="submit"
                        name="language"
                        value="{{ lang_code }}"
                        class="btn btn-link btn-sm {% if CURRENT_LANGUAGE == lang_code %}
                          text-primary
                        {% else %}
                          text-muted
                        {% endif %}">
                        <span class="fi fi-{% if lang_code == 'de' %}
                            de
                          {% else %}
                            gb
                          {% endif %}">

                        </span>
                        {% if lang_code == 'de' %}
                          {% trans 'Deutsch' %}
                        {% else %}
                          {% trans 'English' %}(Beta)
                        {% endif %}
                      </button>
                    {% endfor %}
                  </form>
                </div>
              </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-4">
              <a href="" class="text-white text-decoration-none small">{% trans 'Datenschutz' %}</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Password Manager Modal -->
    <div class="modal fade" id="passwordManagerModal" tabindex="-1" aria-labelledby="passwordManagerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold" id="passwordManagerModalLabel">{% trans 'Was ist ein Passwort-Manager?' %}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body pt-0">
            <p>{% trans 'Ein Passwort-Manager ist ein Programm, das dir dabei hilft, sichere Passwörter zu erstellen und zu speichern. Du musst dir dann nicht mehr alle Passwörter merken!' %}</p>
            <h6 class="fw-bold mt-3 mb-2">{% trans 'Was bringt dir das?' %}</h6>
            <ul>
              <li>{% trans 'Erstellt automatisch sichere Passwörter für dich' %}</li>
              <li>{% trans 'Speichert alle deine Passwörter sicher' %}</li>
              <li>{% trans 'Füllt automatisch deine Logins aus' %}</li>
              <li>{% trans 'Schützt dich vor Betrügern' %}</li>
              <li>{% trans 'Funktioniert auf allen deinen Geräten' %}</li>
            </ul>
            <h6 class="fw-bold mt-3 mb-2">{% trans 'Beliebte Passwort-Manager sind:' %}</h6>
              <ul>
                <li><a href="https://bitwarden.com/" target="_blank" rel="noopener noreferrer">Bitwarden</a></li>
                <li><a href="https://1password.com/" target="_blank" rel="noopener noreferrer">1Password</a></li>
                <li><a href="https://proton.me/de/pass" target="_blank" rel="noopener noreferrer">Proton Pass</a></li>
              </ul>
          </div>
          <div class="modal-footer border-0">
            <button type="button" class="btn btn-primary rounded-3" data-bs-dismiss="modal">{% trans 'Schließen' %}</button>
          </div>
        </div>
      </div>
    </div>

    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  </body>
</html>
