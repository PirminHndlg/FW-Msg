{% load static %}
{% load base_filter %}
{% load base_fw_filter %}
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    {% include 'header.html' %}

    <title>
      Volunteer.Solutions{% block title %}

      {% endblock %}
    </title>

    <link rel="stylesheet" href="{% static 'css/baseFw.css' %}" />
    <link rel="stylesheet" href="{% static 'css/styleFw.css' %}" />
    <script src="{% static 'js/baseFw.js' %}"></script>

    <style>
      :root {
        {% comment %} --background-color: #f8f9fa; {% endcomment %}
        --text_color_on_org_color: white;
      }
      
      /* Larger icons for medium screens only */
      @media (min-width: 768px) and (max-width: 991.98px) {
        .icon-md-lg {
          font-size: 1.5rem !important;
        }
      }
      
      .overflow-y-auto {
        overflow-y: auto;
      }
      
      .overflow-x-hidden {
        overflow-x: hidden;
      }
      
      .flex-grow-1 {
        flex-grow: 1;
      }
      
      .min-height-0 {
        min-height: 0;
      }
      
      /* Active page highlighting */
      .nav-link.active {
        background-color: rgba(255, 255, 255, 0.2) !important;
        border-radius: 0.375rem;
        font-weight: 500;
      }
      
      .nav-link.active i {
        opacity: 1;
      }
    </style>

    {% block head %}

    {% endblock %}

    {% block scripts %}

    {% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-dark bg-primary d-md-none">
      <div class="container-fluid">
        <!-- Logo/Brand -->
        <a class="navbar-brand" href="{% url 'index_home' %}">
          {% with org=user|get_org %}
            <img src="{% url 'serve_image' org.id %}" alt="{{ org.name }}-Logo" style="height: 30px;" />
          {% endwith %}
        </a>

        <!-- Hamburger Menu Button -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNavContent" aria-controls="mobileNavContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      </div>
    </nav>

    <!-- Mobile Navigation Collapse Content -->
    <div class="collapse bg-primary d-md-none" id="mobileNavContent">
      <div class="container-fluid py-3 d-flex justify-content-between align-items-start">
        <ul class="nav flex-column text-on-org-color mt-0">
          {% if user.person_cluster.posts %}
            <li class="nav-item">
              <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'posts_overview' %}"><i class="bi bi-journal-text me-1"></i>{% trans 'Beiträge' %}</a>
            </li>
          {% endif %}
          {% if user.person_cluster.map %}
            <li class="nav-item">
              <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'karte' %}" title="{% trans 'Karte' %}"><i class="bi bi-map me-1"></i>{% trans 'Karte' %}</a>
            </li>
        {% endif %}
          {% if user.person_cluster.ampel %}
            <li class="nav-item">
              <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'ampel' %}"><i class="bi bi-circle-fill me-1"></i>{% trans 'Ampelmeldung' %}</a>
            </li>
          {% endif %}
          {% if user.person_cluster.calendar %}
            <li class="nav-item">
              <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'kalender' %}"><i class="bi bi-calendar-date me-1"></i>{% trans 'Kalender' %}</a>
            </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'laenderinfo' %}"><i class="bi bi-people me-1"></i>{% trans 'Mein Einsatzland' %}</a>
          </li>
          {% if user.person_cluster.notfallkontakt %}
            <li class="nav-item">
              <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'notfallkontakte' %}"><i class="bi bi-person-rolodex me-1"></i>{% trans 'Notfallkontakte' %}</a>
            </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'settings' %}"><i class="bi bi-gear me-1"></i>{% trans 'Einstellungen' %}</a>
          </li>
        </ul>
        {% include 'components/language_selector.html' %}
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar for large devices -->
        <nav class="col-lg-2 bg-primary d-none d-lg-flex flex-column vh-100 p-3 position-sticky top-0">
          <!-- Logo section -->
          <a class="navbar-brand mb-3 d-flex align-items-center flex-wrap link-underline link-underline-opacity-0 link-underline-opacity-0-hover" href="{% url 'fw_home' %}">
            {% with org=user|get_org %}
              <img src="{% url 'serve_image' org.id %}" alt="{{ org.name }}-Logo" style="height: 50px; margin-right: 10px; margin-bottom: 5px;" />
            {% endwith %}
          </a>
          <!-- Scrollable menu section -->
          <div class="overflow-y-auto overflow-x-hidden flex-grow-1" style="min-height: 0;">
            <ul class="nav flex-column gap-2">
              <!-- Main Navigation -->
              <li class="nav-item">
                <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'fw_home' %}">
                  <i class="bi bi-house me-1"></i>{% trans 'Home' %}
                </a>
              </li>
              
              <!-- Content & Activities Section -->
              <li class="nav-item mt-3">
                <small class="text-muted px-0 py-1" style="color: var(--text_color_on_org_color); opacity: 0.7; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">{% trans 'Content & Activities' %}</small>
              </li>
              {% if user.person_cluster.aufgaben %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'aufgaben' %}">
                    <i class="bi bi-list-check me-1"></i>{% trans 'Aufgaben' %}
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.calendar %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'kalender' %}">
                    <i class="bi bi-calendar-date me-1"></i>{% trans 'Kalender' %}
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.ampel %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'ampel' %}">
                    <i class="bi bi-circle-fill me-1"></i>{% trans 'Ampelmeldung' %}
                  </a>
                </li>
              {% endif %}
              
              <!-- Media & Documents Section -->
              <li class="nav-item mt-3">
                <small class="text-muted px-0 py-1" style="color: var(--text_color_on_org_color); opacity: 0.7; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">{% trans 'Media & Documents' %}</small>
              </li>
              {% if user.person_cluster.bilder %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'bilder' %}">
                    <i class="bi bi-image me-1"></i>{% trans 'Bilder' %}
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.posts %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'posts_overview' %}">
                    <i class="bi bi-journal-text me-1"></i>{% trans 'Beiträge' %}
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.dokumente %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'dokumente' %}">
                    <i class="bi bi-file-earmark-text me-1"></i>{% trans 'Dokumente' %}
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.map %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'karte' %}">
                    <i class="bi bi-map me-1"></i>{% trans 'Karte' %}
                  </a>
                </li>
              {% endif %}
              
              <!-- Information & Contacts Section -->
              <li class="nav-item mt-3">
                <small class="text-muted px-0 py-1" style="color: var(--text_color_on_org_color); opacity: 0.7; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">{% trans 'Information & Contacts' %}</small>
              </li>
              <li class="nav-item">
                <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'laenderinfo' %}">
                  <i class="bi bi-people me-1"></i>{% trans 'Mein Einsatzland' %}
                </a>
              </li>
              {% if user.person_cluster.notfallkontakt %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'notfallkontakte' %}">
                    <i class="bi bi-person-rolodex me-1"></i>{% trans 'Notfallkontakte' %}
                  </a>
                </li>
              {% endif %}
              
              <!-- Account & Settings Section -->
              <li class="nav-item mt-3">
                <small class="text-muted px-0 py-1" style="color: var(--text_color_on_org_color); opacity: 0.7; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">{% trans 'Account & Settings' %}</small>
              </li>
              <li class="nav-item">
                <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'profil' %}">
                  <i class="bi bi-person me-1"></i>{% trans 'Profil' %}
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link px-0 py-1" style="color: var(--text_color_on_org_color);" href="{% url 'settings' %}">
                  <i class="bi bi-gear me-1"></i>{% trans 'Einstellungen' %}
                </a>
              </li>
            </ul>
          </div>

          <!-- Fixed language selector at bottom -->
          {% include 'components/language_selector.html' with label=True %}
        </nav>

        <!-- Sidebar for medium devices -->
        <nav class="col-md-1 bg-primary d-none d-md-flex d-lg-none flex-column vh-100 p-1 position-sticky top-0">
          <!-- Logo section -->
          <a class="navbar-brand mb-3 d-flex align-items-center justify-content-center" href="{% url 'fw_home' %}">
            {% with org=user|get_org %}
              <img src="{% url 'serve_image' org.id %}" alt="{{ org.name }}-Logo" style="width: 100%;" />
            {% endwith %}
          </a>
          <!-- Scrollable menu section -->
          <div class="overflow-y-auto overflow-x-hidden flex-grow-1" style="min-height: 0;">
            <ul class="nav flex-column gap-2">
              <!-- Main Navigation -->
              <li class="nav-item">
                <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'fw_home' %}" title="{% trans 'Home' %}">
                  <i class="bi bi-house icon-md-lg"></i>
                </a>
              </li>
              
              <!-- Content & Activities -->
              {% if user.person_cluster.aufgaben %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'aufgaben' %}" title="{% trans 'Aufgaben' %}">
                    <i class="bi bi-list-check icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.calendar %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'kalender' %}" title="{% trans 'Kalender' %}">
                    <i class="bi bi-calendar-date icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.ampel %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'ampel' %}" title="{% trans 'Ampelmeldung' %}">
                    <i class="bi bi-circle-fill icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              
              <!-- Media & Documents -->
              {% if user.person_cluster.bilder %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'bilder' %}" title="{% trans 'Bilder' %}">
                    <i class="bi bi-image icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.posts %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'posts_overview' %}" title="{% trans 'Beiträge' %}">
                    <i class="bi bi-journal-text icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.dokumente %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'dokumente' %}" title="{% trans 'Dokumente' %}">
                    <i class="bi bi-file-earmark-text icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              {% if user.person_cluster.map %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'karte' %}" title="{% trans 'Karte' %}">
                    <i class="bi bi-map icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              <!-- Information & Contacts -->
              <li class="nav-item">
                <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'laenderinfo' %}" title="{% trans 'Mein Einsatzland' %}">
                  <i class="bi bi-people icon-md-lg"></i>
                </a>
              </li>
              {% if user.person_cluster.notfallkontakt %}
                <li class="nav-item">
                  <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'notfallkontakte' %}" title="{% trans 'Notfallkontakte' %}">
                    <i class="bi bi-person-rolodex icon-md-lg"></i>
                  </a>
                </li>
              {% endif %}
              
              <!-- Account & Settings -->
              <li class="nav-item">
                <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'profil' %}" title="{% trans 'Profil' %}">
                  <i class="bi bi-person icon-md-lg"></i>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link px-0 py-2 d-flex justify-content-center" style="color: var(--text_color_on_org_color);" href="{% url 'settings' %}" title="{% trans 'Einstellungen' %}">
                  <i class="bi bi-gear icon-md-lg"></i>
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Main content -->
        <main class="col-lg-10 col-md-11 col-sm-12 pt-3 pb-5 pb-lg-3 mb-4 mb-lg-0 h-100" style="background-color: var(--background-color); margin-bottom: 70px; min-height: 100vh;">
          {% include 'error_message.html' %}
          {% block content %}

          {% endblock %}
        </main>
      </div>
    </div>

    <!-- Bottom Navbar for small devices -->
    <nav class="navbar navbar-dark bg-primary d-md-none fixed-bottom p-0">
      <div class="container-fluid">
        <ul class="navbar-nav nav-justified w-100 d-flex flex-row">
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'fw_home' %}">
              <i class="bi bi-house"></i>
              <div>
                {% trans 'Home' %}
              </div>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'aufgaben' %}">
              <i class="bi bi-list-check"></i>
              <div>
                {% trans 'Aufgaben' %}
              </div>
            </a>
          </li>
          <li class="nav-item text-center">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="#" id="dropdownAdd" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-plus-circle text-on-org-color"></i>
              <div>Add</div>
            </a>
            <ul class="dropdown-menu position-absolute" aria-labelledby="dropdownAdd" style="top: auto; bottom: 80%; left: 50%; transform: translateX(-50%);">
              <li>
                <a class="dropdown-item" href="{% url 'bild' %}">{% trans 'Bilder hochladen' %}</a>
              </li>
              <li>
                <a class="dropdown-item" href="{% url 'ampel' %}">{% trans 'Ampelmeldung' %}</a>
              </li>
              <li>
                <a class="dropdown-item" href="{% url 'feedback' %}">{% trans 'Feedback' %}</a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'dokumente' %}">
              <i class="bi bi-file-earmark-text"></i>
              <div>
                {% trans 'Dokumente' %}
              </div>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" style="color: var(--text_color_on_org_color);" href="{% url 'profil' %}">
              <i class="bi bi-person"></i>
              <div>
                {% trans 'Profil' %}
              </div>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <script src="{% static 'js/base.js' %}"></script>
    <script>
      // Function to highlight current page
      function highlightCurrentPage() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('a[href]');

        navLinks.forEach(link => {
          // Get the href attribute
          const href = link.getAttribute('href');

          // Skip if no href or if it's a dropdown toggle
          if (!href || href === '#' || link.getAttribute('data-bs-toggle') === 'dropdown') {
            return;
          }

          // Extract the URL name from Django template tags
          if (currentPath.endsWith(href)) {
            link.classList.add('active');
          } else {
            link.classList.remove('active');
          }
        });
      }

      // Run on page load
      document.addEventListener('DOMContentLoaded', highlightCurrentPage);

      // Run when navigating (for SPA-like behavior)
      window.addEventListener('popstate', highlightCurrentPage);

    </script>

  </body>
</html>
